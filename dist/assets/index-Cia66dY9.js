(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))l(e);new MutationObserver(e=>{for(const r of e)if(r.type==="childList")for(const t of r.addedNodes)t.tagName==="LINK"&&t.rel==="modulepreload"&&l(t)}).observe(document,{childList:!0,subtree:!0});function c(e){const r={};return e.integrity&&(r.integrity=e.integrity),e.referrerPolicy&&(r.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?r.credentials="include":e.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(e){if(e.ep)return;e.ep=!0;const r=c(e);fetch(e.href,r)}})();const I=40,q=.5,y=60/I,M=q*y,B=q*y,R=256,C=8,P=R*y,D=document.querySelector("button"),L=1/3,A=y/3*2,F=n=>440*Math.pow(2,n/12),x=(n,o,c)=>{const l=n.createOscillator();l.frequency.value=F(c);const e=o+B;l.start(o),l.stop(e),l.detune.value=(Math.random()-.5)*10;const r=n.createGain();return r.gain.setValueAtTime(0,o),r.gain.linearRampToValueAtTime(1,o+M/1024),r.gain.linearRampToValueAtTime(.2,o+M/16),r.gain.linearRampToValueAtTime(0,e),setTimeout(()=>l.disconnect(),e*1e3+1e3),l.connect(r)};function G(n,o,c){const l=new AnalyserNode(n,{fftSize:2048,smoothingTimeConstant:1}),e=new DynamicsCompressorNode(n,{threshold:-40,knee:40,ratio:4,attack:0,release:y/8});e.connect(l),l.connect(o);const r=new DelayNode(n,{maxDelayTime:A,delayTime:A}),t=new DelayNode(n,{maxDelayTime:A,delayTime:A}),g=new GainNode(n,{gain:L}),d=new GainNode(n,{gain:L}),s=new BiquadFilterNode(n,{type:"lowpass",frequency:2e4,Q:0});s.connect(e),r.connect(d).connect(t).connect(new StereoPannerNode(n,{pan:-1})).connect(e),t.connect(g).connect(r).connect(new StereoPannerNode(n,{pan:1})).connect(e);let h=0;for(const[m,N]of Object.entries(c))for(const i of N)x(n,Number(m),i).connect(s).connect(h++%2?d:g);return{analyser:l,filter:s}}const b=n=>1+n/96,V=n=>new Proxy(Object.create(null),{get:(o,c)=>(Object.hasOwn(o,c)||(o[c]=n()),o[c]),ownKeys:o=>Reflect.ownKeys(o).sort((c,l)=>Number(c)-Number(l))}),v=n=>getComputedStyle(document.documentElement).getPropertyValue(n).trim();function Y(n,o,c,l,e,r,t,g,d){const s=n.getContext("2d");if(!s)throw Error("failed to get 2d rendering context");const h=Math.min(o,c),m=d.frequencyBinCount,N=new Uint8Array(m),i=new Set;for(const[a,T]of Object.entries(e)){const p=Number(a);if(r>=p&&r<=p+M)for(const w of T)i.add(w)}const f=()=>{d.getByteTimeDomainData(N),s.lineWidth=3,s.strokeStyle=v("--color-figure"),s.globalAlpha=1/8,s.beginPath();const a=o/m;let T=0;for(let p=0;p<m;p++){const w=N[p]/128,E=(c+w*c)/4;p===0?s.moveTo(T,E):s.lineTo(T,E),T+=a}s.lineTo(o,c/2),s.stroke(),s.globalAlpha=1,s.lineWidth=1};s.strokeStyle=v("--color-figure"),s.clearRect(0,0,o,c),f();const u=new Set;for(let a=0;a<t.length;a++)u.add({note:t[a],period:b(a)});for(let a=0;a<g.length;a++)u.add({note:g[a],period:b(a)});const S=Math.min(...t,...g),O=Math.max(...t,...g)-S;for(const{note:a,period:T}of u){const p=i.has(a),w=h*.2*(a+O/10+Math.abs(S))/O*1.1;s.beginPath(),s.arc(o/2,c/2,w,0,2*Math.PI),s.stroke();const E=l/y/T*2*Math.PI-Math.PI/2;s.beginPath(),s.arc(w*Math.cos(E)+o/2,w*Math.sin(E)+c/2,h/u.size/16,0,2*Math.PI),s.fillStyle=v(p?"--color-accent":"--color-figure"),s.fill()}}function j(n,o){let c;D.onclick=()=>{D.remove(),c||(c=new AudioContext);const l=new GainNode(c,{gain:.1});l.connect(c.destination);const e=c.currentTime+.1,r=V(Array);for(let i=0;i<R;i++)if(Math.floor(i/C%2))for(let f=0;f<o.length;f++){const u=e+i*b(f)*y;if(u>=e+P)break;r[u].push(o[f])}else for(let f=0;f<n.length;f++){const u=e+i*b(f)*y;if(u>=e+P)break;r[u].push(n[f])}const t=document.querySelector("canvas");if(!t)throw Error("canvas missing");const{analyser:g,filter:d}=G(c,l,r),s=(i,f)=>{const u=t.getBoundingClientRect(),S=i-u.left,_=f-u.top,O=Math.max(0,Math.min(1,S/u.width));d.frequency.value=20+O**2*4e3;const a=Math.max(0,Math.min(1,1-_/u.height));d.Q.value=a*36};t.onmousemove=i=>s(i.clientX,i.clientY),t.onmouseleave=()=>{d.Q.value=0,d.frequency.value=2e4},t.addEventListener("touchmove",i=>{i.preventDefault(),i.touches.length&&s(i.touches[0].clientX,i.touches[0].clientY)},{passive:!1}),t.addEventListener("touchend",()=>{d.Q.value=0,d.frequency.value=2e4}),t.addEventListener("touchcancel",()=>{d.Q.value=0,d.frequency.value=2e4});let h=512,m=512;t.width=h,t.height=m,document.addEventListener("fullscreenchange",()=>{document.fullscreenElement===t?(h=window.screen.width,m=window.screen.height):(h=512,m=512),t.width=h,t.height=m}),t.addEventListener("click",()=>{if(document.fullscreenElement){document.exitFullscreen();return}t.requestFullscreen()}),t.hidden=!1;const N=()=>{const i=c.currentTime-e;if(i>P){t.hidden=!0,document.fullscreenElement&&document.exitFullscreen(),l.disconnect(),document.body.prepend(D);return}requestAnimationFrame(N),!(i<0)&&Y(t,h,m,i,r,c.currentTime,n,o,g)};requestAnimationFrame(N)}}const Q=[-17,-10,2,10,14],U=[-21,3,7,10,19];j(Q,U);
